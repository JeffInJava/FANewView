SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(e){return e.getScreenCTM().inverse().multiply(this.getScreenCTM())},function(e){e.plugin(function(e,t,a,n,r){var o,i={uniqueIdPrefix:"snapsvg-zpd-",dataStore:{},enable:!0},s=function(e){if(e.parentNode){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}},d=function(e,t){return void 0===t?parseInt(e):"+"==t[0]?e+parseInt(t.split("+")[1]):"-"==t[0]?e-parseInt(t.split("-")[1]):parseInt(t)},l=function(t,a,n){if(n&&"object"==typeof n){var r=e(t).transform().globalMatrix;if(a.a<r.a&&a.a<n[0])return;if(a.a>r.a&&a.a>n[1])return;if(a.d<r.d&&a.d<n[0])return;if(a.d>r.d&&a.d>n[1])return}var o="matrix("+a.a+","+a.b+","+a.c+","+a.d+","+a.e+","+a.f+")";t.setAttribute("transform",o)},u=function(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]},f=function(e,t){var a=t.node.createSVGPoint(),n=u(t.node);return a.x=e.clientX-n[0],a.y=e.clientY-n[1],a},m=function(e){return"matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")"},v=function(e,t){o=e.node;var a=e.node.childNodes,n=e.g(),r=n.node;if(r.id=i.uniqueIdPrefix+e.id,t.load&&"object"==typeof t.load){var s=t.load,d="matrix("+s.a+","+s.b+","+s.c+","+s.d+","+s.e+","+s.f+")";n.transform(d)}else n.transform("matrix");for(var l=0,u=a.length-1;u>l;)r.appendChild(a[0]),l+=1;var f={svg:e,root:e.node,state:"none",stateTarget:null,stateOrigin:null,stateTf:null},m={element:n,data:f,options:t};return m.handlerFunctions=p(m),m},p=function(e){var t=function(t){t.preventDefault&&t.preventDefault(),i.enable&&(t.returnValue=!1,("pan"==e.data.state||"drag"==e.data.state)&&(e.data.state=""))},a=function(t){if(t.preventDefault&&t.preventDefault(),i.enable){t.returnValue=!1;var a=e.element.node;"svg"!=t.target.tagName&&e.options.drag?(e.data.state="drag",e.data.stateTarget=t.target,e.data.stateTf=a.getCTM().inverse(),e.data.stateOrigin=f(t,e.data.svg).matrixTransform(e.data.stateTf)):(e.data.state="pan",e.data.stateTf=a.getCTM().inverse(),e.data.stateOrigin=f(t,e.data.svg).matrixTransform(e.data.stateTf))}},n=function(t){if(t.preventDefault&&t.preventDefault(),i.enable){t.returnValue=!1;var a=e.element.node;if("pan"==e.data.state&&e.options.pan){var n=f(t,e.data.svg).matrixTransform(e.data.stateTf);l(a,e.data.stateTf.inverse().translate(n.x-e.data.stateOrigin.x,n.y-e.data.stateOrigin.y),e.options.zoomThreshold)}else if("drag"==e.data.state&&e.options.drag){var r=f(t,e.data.svg).matrixTransform(a.getCTM().inverse());l(e.data.stateTarget,e.data.root.createSVGMatrix().translate(r.x-e.data.stateOrigin.x,r.y-e.data.stateOrigin.y).multiply(a.getCTM().inverse()).multiply(e.data.stateTarget.getCTM()),e.options.zoomThreshold),e.data.stateOrigin=r}}},r=function(t){if(e.options.zoom&&(t.preventDefault&&t.preventDefault(),i.enable)){t.returnValue=!1;var a=0;a=t.wheelDelta?t.wheelDelta/360:t.detail/-9;var n=Math.pow(1+e.options.zoomScale,a),r=e.element.node,o=f(t,e.data.svg);o=o.matrixTransform(r.getCTM().inverse());var s=e.data.root.createSVGMatrix().translate(o.x,o.y).scale(n).translate(-o.x,-o.y);l(r,r.getCTM().multiply(s),e.options.zoomThreshold),"undefined"==typeof stateTf&&(e.data.stateTf=r.getCTM().inverse()),e.data.stateTf=e.data.stateTf.multiply(s.inverse())}};return{mouseUp:t,mouseDown:a,mouseMove:n,mouseWheel:r}},g=function(e,t){"onmouseup"in document.documentElement&&(e.addEventListener("mouseup",t.mouseUp,!1),e.addEventListener("mousedown",t.mouseDown,!1),e.addEventListener("mousemove",t.mouseMove,!1),navigator.userAgent.toLowerCase().indexOf("webkit")>=0||navigator.userAgent.toLowerCase().indexOf("trident")>=0?e.addEventListener("mousewheel",t.mouseWheel,!1):e.addEventListener("DOMMouseScroll",t.mouseWheel,!1))},c=function(e,t){e.removeEventListener("mouseup",t.mouseUp,!1),e.removeEventListener("mousedown",t.mouseDown,!1),e.removeEventListener("mousemove",t.mouseMove,!1),navigator.userAgent.toLowerCase().indexOf("webkit")>=0||navigator.userAgent.toLowerCase().indexOf("trident")>=0?e.removeEventListener("mousewheel",t.mouseWheel,!1):e.removeEventListener("DOMMouseScroll",t.mouseWheel,!1)},T=function(e,t){var a,n=this,r={pan:!0,zoom:!0,drag:!1,zoomScale:.2,zoomThreshold:null},o={init:"init",reinit:"reinit",destroy:"destroy",save:"save",origin:"origin",callback:"callback",toggle:"toggle"},d=null;if("function"==typeof e&&(t=e,a=o.callback),i.dataStore.hasOwnProperty(n.id))if(d=i.dataStore[n.id],"object"==typeof e){for(var l in e)d.options[l]=e[l];a=o.reinit}else"string"==typeof e&&(a=e);else{if("object"==typeof e){for(var u in e)r[u]=e[u];a=o.init}else"string"==typeof e&&(a=e);d=v(n,r),g(n.node,d.handlerFunctions),i.dataStore[n.id]=d}switch(a){case o.init:case o.reinit:case o.callback:return void(t&&t(null,d));case o.destroy:return c(n.node,d.handlerFunctions),s(n.node.firstChild),delete i.dataStore[n.id],void(t&&t(null,d));case o.save:var f=document.getElementById(i.uniqueIdPrefix+n.id),m=f.getCTM();return t&&t(null,m),m;case o.origin:return n.zoomTo(1,1e3),void(t&&t(null,d));case o.toggle:return i.enable=!i.enable,void(t&&t(null,i.enable))}},h=function(t,a,n,r){if(0>t||"number"!=typeof t)return void console.error("zoomTo(arg) should be a number and greater than 0");"number"!=typeof a&&(a=3e3);var s=this;if(i.dataStore.hasOwnProperty(s.id)){var d=i.dataStore[s.id].element,l=d.node.getTransformToElement(o),u=l.a,f=l.e,v=l.f,p=d.getBBox(),g=parseFloat(p.width)/2,c=parseFloat(p.height)/2;e.animate(u,t,function(e){var t=e/u;e!==u&&(l.e=f-(g*t-g),l.f=v-(c*t-c),l.a=e,l.d=e,d.node.setAttribute("transform",m(l)))},a,n,r)}},y=function(e,t,a,n,r){var o=this;if(i.dataStore.hasOwnProperty(o.id)){var s=i.dataStore[o.id].element,l=s.node.getCTM(),u=d(l.e,e),f=d(l.f,t),m="matrix("+l.a+","+l.b+","+l.c+","+l.d+","+u+","+f+")";s.animate({transform:m},a||10,n||null,function(){r&&r(null,s)})}},b=function(t,a,n,r,o,s){var d=this;if(i.dataStore.hasOwnProperty(d.id)){var l=i.dataStore[d.id].element,u=l.node.getCTM();"matrix("+u.a+","+u.b+","+u.c+","+u.d+","+u.e+","+u.f+")";a&&"number"==typeof a||(a=d.node.offsetWidth/2),n&&"number"==typeof n||(n=d.node.offsetHeight/2),l.animate({transform:new e.Matrix(u).rotate(t,a,n)},r||10,o||null,function(){s&&s(null,l)})}};a.prototype.zpd=T,a.prototype.zoomTo=h,a.prototype.panTo=y,a.prototype.rotate=b})}(Snap);